#!/bin/bash

REPOS_ROOT='/github'

cd "$REPOS_ROOT/4Share/" || exit
# 清理当前目录下所有将由脚本更新的文件，确保不会保留任何旧文件
find . -type f -iname route.sh -print0 | xargs -0 rm --
find . -type f -iname china_ip_list.txt -print0 | xargs -0 rm --
find . -type f -iname china-ipv4.txt -print0 | xargs -0 rm --
find . -type f -iname china-ipv6.txt -print0 | xargs -0 rm --
find . -type f -iregex ".*ip.*_list_.?.txt" -print0 | xargs -0 rm --
find . -type f -iname accelerated-domains.china.conf -print0 | xargs -0 rm --

# 拷贝最新文件
/bin/cp -f "$REPOS_ROOT/dnsmasq-china-list/accelerated-domains.china.conf" ./
/bin/cp -f "$REPOS_ROOT/china_ip_list/china_ip_list.txt" ./
/bin/mv -f "$REPOS_ROOT/china-operator-ip/china.txt" ./china-ipv4.txt
/bin/mv -f "$REPOS_ROOT/china-operator-ip/china6.txt" ./china-ipv6.txt
fromdos china_ip_list.txt china-ipv6.txt accelerated-domains.china.conf

# 针对北京大学校园网划分网段进行特殊处理
sed -i -E '/^115\.27\.0\.0.*/d' china_ip_list.txt china-ipv4.txt
sed -i -E '/^162\.105\.0\.0.*/d' china_ip_list.txt china-ipv4.txt
sed -i -E '/^202\.112\.7\.0.*/d' china_ip_list.txt china-ipv4.txt
sed -i -E '/^202\.112\.8\.0.*/d' china_ip_list.txt china-ipv4.txt
sed -i -E '/^222\.29\.0\.0.*/d' china_ip_list.txt china-ipv4.txt
sed -i -E '/^222\.29\.128\.0.*/d' china_ip_list.txt china-ipv4.txt
sed -i -E '/^2001:da8:201::.*/d' china-ipv6.txt

# 创建用于写入 Proxifier 规则的 IP 白名单列表
# 1. Proxifier 规则暂不支持 CIDR 格式的 IP 地址，因此需要做格式上的转换
# 2. Proxifier 一条规则内最大能写入 32767 个字符，远远小于格式转换后的 IP 列表字符长，
#    因此需要将 china_ip_list 拆分为多个规则。
fromdos Proxifier/IPConvert.py Proxifier/IPv6Convert.py
python3 Proxifier/IPConvert.py
python3 Proxifier/IPv6Convert.py
/bin/mv -f ip_list_?.txt ipv6_list_?.txt Proxifier
/bin/cp -f china_ip_list.txt geoip_china/china_ip_list.txt

# 通过 sed 命令处理之
sed -i '/^#|^$/d' accelerated-domains.china.conf
sed -i 's/114.114.114.114/223.5.5.5/g' accelerated-domains.china.conf
sed -i '/^server=\/tsdm/d' accelerated-domains.china.conf
sed -i -e "s/^/route\ \${OPS}\ -net\ &/g" -e "s/$/&\ \${ROUTE_GW}/g" china_ip_list.txt

# 建立 route.sh 文件
cat > route.sh << 'END_TEXT'
#/bin/bash
#export PATH="/bin:/sbin:/usr/sbin:/usr/bin"

ROUTE_GW="gw `nvram get wan0_gateway`"

if [ $# -ne 1 ]; then
    echo $0 add/delete
    exit
fi

if [ "$1" != "add" ]  && [ "$1" != "delete" ]; then
    echo $0 add/delete
    exit
fi

if [ "$1" == "delete" ]; then
    ROUTE_GW=""
fi

OPS=$1

# route $OPS -net ${IP_SEGMENT} ${ROUTE_GW}
# Generate:
# wget -qo- https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt
# sed -i -e 's/^/route\ \${OPS}\ -net\ &/g' -e 's/$/&\ \${ROUTE_GW}/g' china_ip_list.txt

# 另一边要用到的命令：
# wget -qo- https://raw.githubusercontent.com/felixonmars/dnsmasq-china-list/master/accelerated-domains.china.conf
# sed -i 's/114.114.114.114/223.5.5.5/g' accelerated-domains.china.conf

END_TEXT

cat china_ip_list.txt >> route.sh

cat >> route.sh << 'END_TEXT'

# https://its.pku.edu.cn/faq.jsp  --获得北大IP网段
# 162.105.0.0/16
# 202.112.7.0/24
# 202.112.8.0/24
# 222.29.0.0/17
# 222.29.128.0/19
# 115.27.0.0/16
# 2001:da8:201::/48
route ${OPS} -net 115.27.0.0/16 ${ROUTE_GW}
route ${OPS} -net 162.105.0.0/16 ${ROUTE_GW}
route ${OPS} -net 202.112.7.0/24 ${ROUTE_GW}
route ${OPS} -net 202.112.8.0/24 ${ROUTE_GW}
route ${OPS} -net 222.29.0.0/17 ${ROUTE_GW}
route ${OPS} -net 222.29.128.0/19 ${ROUTE_GW}
route ${OPS} -A inet6 2001:da8:201::/48 ${ROUTE_GW}
END_TEXT

# 更新 4Share 库 router 目录
/bin/cp -f accelerated-domains.china.conf router
/bin/rm -f china_ip_list.txt china-ipv4.txt china-ipv6.txt
fromdos route.sh
/bin/mv -f route.sh router

# 在已有 accelerated-domains.china.conf 文件的基础上做二次修改，使符合 DNSCrypt 配置格式
sed -i -e 's/server=\///g' -e 's/\//    /g' accelerated-domains.china.conf
sed -i 's/223.5.5.5/45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88,223.5.5.5,223.6.6.6/g' accelerated-domains.china.conf

# 建立 forwarding-rules.txt 文件
cat > forwarding-rules.txt << 'END_TEXT'
##################################
#        Forwarding rules        #
##################################

## This is used to route specific domain names to specific servers.
## The general format is:
## <domain> <server address>[:port] [, <server address>[:port]...]
## IPv6 addresses can be specified by enclosing the address in square brackets.

## In order to enable this feature, the "forwarding_rules" property needs to
## be set to this file name inside the main configuration file.

## Blocking IPv6 may prevent local devices from being discovered.
## If this happens, set `block_ipv6` to `false` in the main config file.

## Forward *.lan, *.local, *.home, *.internal and *.localdomain to 192.168.1.1
# lan             192.168.1.1
# local           192.168.1.1
# home            192.168.1.1
# internal        192.168.1.1
# localdomain     192.168.1.1

## Forward queries for example.com and *.example.com to 9.9.9.9 and 8.8.8.8
# example.com     9.9.9.9,8.8.8.8

# To generate:
# sed -i -e 's/server=\///g' -e 's/\//    /g' accelerated-domains.china.conf

lan    192.168.50.1
local    192.168.50.1
home    192.168.50.1
internal    192.168.50.1
localdomain    192.168.50.1
workgroup    192.168.50.1
# 10.in-addr.arpa    192.168.50.1
192.in-addr.arpa    192.168.50.1
# 254.169.in-addr.arpa    192.168.50.1
# 16.172.in-addr.arpa    192.168.50.1
# 17.172.in-addr.arpa    192.168.50.1
# 18.172.in-addr.arpa    192.168.50.1
# 19.172.in-addr.arpa    192.168.50.1
# 20.172.in-addr.arpa    192.168.50.1
# 21.172.in-addr.arpa    192.168.50.1
# 22.172.in-addr.arpa    192.168.50.1
# 23.172.in-addr.arpa    192.168.50.1
# 24.172.in-addr.arpa    192.168.50.1
# 25.172.in-addr.arpa    192.168.50.1
# 26.172.in-addr.arpa    192.168.50.1
# 27.172.in-addr.arpa    192.168.50.1
# 28.172.in-addr.arpa    192.168.50.1
# 29.172.in-addr.arpa    192.168.50.1
# 30.172.in-addr.arpa    192.168.50.1
# 31.172.in-addr.arpa    192.168.50.1

# google.com        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ad        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ae        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.af        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ag        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ai        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.al        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.am        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.ao        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ar        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.as        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.at        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.au        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.az        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ba        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.bd        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.be        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.bf        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.bg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.bh        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.bi        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.bj        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.bn        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.bo        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.br        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.bs        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.bt        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.bw        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.by        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.bz        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ca        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cd        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cf        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ch        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ci        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.ck        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cl        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cn        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.co        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.cr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.cu        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cv        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.cy        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cz        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.de        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.dj        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.dk        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.dm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.do        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.dz        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ec        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ee        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.eg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.es        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.et        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.fi        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.fj        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.fm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.fr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ga        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ge        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.gg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.gh        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.gi        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.gl        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.gm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.gp        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.gr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.gt        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.gy        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.hk        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.hn        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.hr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ht        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.hu        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.id        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ie        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.il        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.im        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.in        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.iq        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.is        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.it        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.je        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.jm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.jo        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.jp        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.ke        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.kh        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ki        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.kg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.kr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.kw        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.kz        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.la        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.lb        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.li        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.lk        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.ls        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.lt        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.lu        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.lv        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ly        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.ma        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.md        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.me        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.mg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.mk        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ml        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.mm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.mn        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ms        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.mt        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.mu        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.mv        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.mw        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.mx        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.my        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.mz        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.na        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.nf        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ng        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ni        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ne        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.nl        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.no        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.np        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.nr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.nu        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.nz        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.om        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.pa        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.pe        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.pg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ph        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.pk        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.pl        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.pn        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.pr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ps        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.pt        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.py        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.qa        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ro        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ru        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.rw        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.sa        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.sb        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.sc        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.se        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.sg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.sh        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.si        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.sk        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.sl        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.sn        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.so        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.sm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.sr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.st        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.sv        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.td        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.tg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.th        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.tj        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.tk        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.tl        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.tm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.tn        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.to        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.tr        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.tt        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.tw        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.tz        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.ua        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.ug        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.uk        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.uy        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.uz        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.vc        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.ve        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.vg        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.vi        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.com.vn        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.vu        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.ws        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.rs        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.za        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.zm        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.co.zw        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# google.cat        45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# youtube.com    45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# youtu.be    45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
# facebook.com    45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88

altmetric.com    162.105.129.122,162.105.129.88
apabi.com    162.105.129.122,162.105.129.88
clarivate.com    162.105.129.122,162.105.129.88
doi.org    162.105.129.122,162.105.129.88
els-cdn.com    162.105.129.122,162.105.129.88
elsevier-ae.com    162.105.129.122,162.105.129.88
elsevier.com    162.105.129.122,162.105.129.88
evise.com    162.105.129.122,162.105.129.88
japanknowledge.com    162.105.129.122,162.105.129.88
jbe-platform.com    162.105.129.122,162.105.129.88
jstor.org    162.105.129.122,162.105.129.88
literatumonline.com    162.105.129.122,162.105.129.88
mywconline.com    162.105.129.122,162.105.129.88
oup.com    162.105.129.122,162.105.129.88
pkuhelper.com    162.105.129.122,162.105.129.88
pnas.org    162.105.129.122,162.105.129.88
proquest.com    162.105.129.122,162.105.129.88
researchgate.net    162.105.129.122,162.105.129.88
rgstatic.net    162.105.129.122,162.105.129.88
sciencedirect.com    162.105.129.122,162.105.129.88
sciencedirectassets.com    162.105.129.122,162.105.129.88
scopus.com    162.105.129.122,162.105.129.88
serialssolutions.com    162.105.129.122,162.105.129.88
silverchair-cdn.com    162.105.129.122,162.105.129.88
springer.com    162.105.129.122,162.105.129.88
springernature.com    162.105.129.122,162.105.129.88
tandfonline.com    162.105.129.122,162.105.129.88
thomsonreuters.com    162.105.129.122,162.105.129.88
tuna.moe    162.105.129.122,162.105.129.88
webofknowledge.com    162.105.129.122,162.105.129.88
webofscience.com    162.105.129.122,162.105.129.88
wiley.com    162.105.129.122,162.105.129.88
wkap.nl    162.105.129.122,162.105.129.88

npupt.com    45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
byr.cn    45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
pku.edu.cn    45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
edu.cn    45.90.28.105,45.90.30.105,162.105.129.122,162.105.129.88
ac.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
com.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
org.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
net.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
gov.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
mil.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
ah.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
bj.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
cq.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
fj.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
gd.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
gs.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
gz.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
gx.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
ha.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
hb.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
he.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
hi.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
hl.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
hn.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
jl.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
js.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
jx.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
ln.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
nm.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
nx.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
qh.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
sc.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
sd.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
sh.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
sn.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
sx.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
tj.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
yn.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
zj.cn    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
xn--fiqs8s    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6
xn--fiqz9s    45.90.28.105,45.90.30.105,223.5.5.5,223.6.6.6

END_TEXT

cat accelerated-domains.china.conf >> forwarding-rules.txt

# 更新 4Share 库 DNSCrypt 目录
/bin/rm -f accelerated-domains.china.conf
fromdos forwarding-rules.txt
/bin/mv -f forwarding-rules.txt DNSCrypt

# 推送更新到 GitHub
git add -- *
git commit -a -m "Auto Commit"
git push

